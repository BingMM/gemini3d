cmake_minimum_required(VERSION 3.1)
project(TimeUtilities LANGUAGES Fortran)
enable_testing()

get_directory_property(hasParent PARENT_DIRECTORY)
if(NOT hasParent)
  if(NOT realbits)
    set(realbits 64)
  endif()
  include(${CMAKE_CURRENT_SOURCE_DIR}/../cmake/compilers.cmake)
  add_library(const ${CMAKE_CURRENT_SOURCE_DIR}/../numerical/constants/phys_consts.F90)
  target_compile_definitions(const PRIVATE REALBITS=${realbits})
  set_target_properties(const PROPERTIES Fortran_MODULE_DIRECTORY ${CMAKE_BINARY_DIR})
endif()

add_library(timeutils timeutils.f90)
target_link_libraries(timeutils PRIVATE const)
target_compile_options(timeutils PRIVATE ${FFLAGS})
set_target_properties(timeutils PROPERTIES Fortran_MODULE_DIRECTORY ${CMAKE_BINARY_DIR})

add_executable(test_rollover test_dayrollover.f90)
target_compile_options(test_rollover PRIVATE ${FFLAGS})
target_link_libraries(test_rollover PRIVATE timeutils const)
set_target_properties(test_rollover PROPERTIES Fortran_MODULE_DIRECTORY ${CMAKE_BINARY_DIR})
add_test(NAME DateRollover COMMAND test_rollover)

add_executable(test_sza test_sza.f90)
target_compile_options(test_sza PRIVATE ${FFLAGS})
target_link_libraries(test_sza PRIVATE timeutils const)
set_target_properties(test_sza PROPERTIES Fortran_MODULE_DIRECTORY ${CMAKE_BINARY_DIR})
add_test(NAME SolarZenithAngle COMMAND test_sza)
